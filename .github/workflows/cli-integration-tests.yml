name: CLI Integration Tests

on:
  workflow_dispatch:
  push:
    branches:
      - main

  pull_request_target:
    types: [labeled]
    branches:
      - main

  pull_request:
    types: [opened, synchronize, reopened, labeled]
    branches:
      - main

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.sha }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  Remove-Label:
    if: contains(github.event.pull_request.labels.*.name, 'safe to test')
    name: Remove label
    runs-on: ubuntu-latest
    steps:
      - name: Remove 'safe to test'
        uses: actions-ecosystem/action-remove-labels@v1
        with:
          labels: "safe to test"

  Detect-Deps:
    name: Detect Dependencies
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'push' || contains(github.event.pull_request.labels.*.name, 'safe to test')
    runs-on: ubuntu-latest
    outputs:
      build_info_go_repo: ${{ steps.detect.outputs.build_info_go_repo }}
      build_info_go_ref: ${{ steps.detect.outputs.build_info_go_ref }}
      jfrog_client_go_repo: ${{ steps.detect.outputs.jfrog_client_go_repo }}
      jfrog_client_go_ref: ${{ steps.detect.outputs.jfrog_client_go_ref }}
      jfrog_cli_core_repo: ${{ steps.detect.outputs.jfrog_cli_core_repo }}
      jfrog_cli_core_ref: ${{ steps.detect.outputs.jfrog_cli_core_ref }}
    steps:
      - name: Checkout jfrog-cli-artifactory
        uses: actions/checkout@v5
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name || github.repository }}
          ref: ${{ github.event.pull_request.head.sha || github.sha }}

      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.23'
          cache: false

      - name: Detect dependencies
        id: detect
        run: go run .github/tools/detect-deps/main.go
        env:
          CURRENT_BRANCH: ${{ github.head_ref || github.ref_name }}

  Artifactory-Tests:
    name: ${{ matrix.suite }} ${{ matrix.os.name }}
    needs: Detect-Deps
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'push' || contains(github.event.pull_request.labels.*.name, 'safe to test')
    strategy:
      fail-fast: false
      matrix:
        suite: [artifactory, artifactoryProject]
        os:
          - name: ubuntu
            version: 24.04
          - name: windows
            version: 2022
    runs-on: ${{ matrix.os.name }}-${{ matrix.os.version }}
    env:
      JFROG_CLI_LOG_LEVEL: DEBUG
      GOPROXY: direct
    steps:
      # First checkout jfrog-cli-artifactory to root to make composite action available
      - name: Checkout jfrog-cli-artifactory
        uses: actions/checkout@v5
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name || github.repository }}
          ref: ${{ github.event.pull_request.head.sha || github.sha }}
          path: jfrog-cli-artifactory

      - name: Checkout jfrog-cli
        uses: actions/checkout@v5
        with:
          repository: jfrog/jfrog-cli
          ref: master
          path: jfrog-cli

      - name: Checkout build-info-go
        if: needs.Detect-Deps.outputs.build_info_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.build_info_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.build_info_go_ref }}
          path: build-info-go

      - name: Checkout jfrog-client-go
        if: needs.Detect-Deps.outputs.jfrog_client_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_client_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_client_go_ref }}
          path: jfrog-client-go

      - name: Checkout jfrog-cli-core
        if: needs.Detect-Deps.outputs.jfrog_cli_core_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_ref }}
          path: jfrog-cli-core

      - name: Setup Go with cache
        uses: jfrog/.github/actions/install-go-with-cache@main

      - name: Setup Go workspace (Unix)
        if: matrix.os.name == 'ubuntu'
        shell: bash
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          [ -d "./build-info-go" ] && go work use ./build-info-go || true
          [ -d "./jfrog-client-go" ] && go work use ./jfrog-client-go || true
          [ -d "./jfrog-cli-core" ] && go work use ./jfrog-cli-core || true
          cat go.work

      - name: Setup Go workspace (Windows)
        if: matrix.os.name == 'windows'
        shell: pwsh
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          if (Test-Path "./build-info-go") { go work use ./build-info-go }
          if (Test-Path "./jfrog-client-go") { go work use ./jfrog-client-go }
          if (Test-Path "./jfrog-cli-core") { go work use ./jfrog-cli-core }
          Get-Content go.work

      - name: Install local Artifactory
        uses: jfrog/.github/actions/install-local-artifactory@main
        with:
          RTLIC: ${{ secrets.RTLIC }}
          RT_CONNECTION_TIMEOUT_SECONDS: '1200'

      - name: Run Artifactory tests
        if: matrix.suite == 'artifactory'
        working-directory: jfrog-cli
        run: go test -v github.com/jfrog/jfrog-cli --timeout 0 --test.artifactory --jfrog.url=http://127.0.0.1:8082 --jfrog.adminToken=${{ env.JFROG_TESTS_LOCAL_ACCESS_TOKEN }}

      - name: Run Artifactory Project tests
        if: matrix.suite == 'artifactoryProject'
        working-directory: jfrog-cli
        run: go test -v github.com/jfrog/jfrog-cli --timeout 0 --test.artifactoryProject --ci.runId=${{ runner.os }}-${{ matrix.suite }}

  Go-Tests:
    name: Go ${{ matrix.os.name }}
    needs: Detect-Deps
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'push' || contains(github.event.pull_request.labels.*.name, 'safe to test')
    strategy:
      fail-fast: false
      matrix:
        os:
          - name: ubuntu
            version: 24.04
          - name: windows
            version: 2022
    runs-on: ${{ matrix.os.name }}-${{ matrix.os.version }}
    env:
      JFROG_CLI_LOG_LEVEL: DEBUG
      GOPROXY: direct
    steps:
      - name: Checkout jfrog-cli-artifactory
        uses: actions/checkout@v5
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name || github.repository }}
          ref: ${{ github.event.pull_request.head.sha || github.sha }}
          path: jfrog-cli-artifactory

      - name: Checkout jfrog-cli
        uses: actions/checkout@v5
        with:
          repository: jfrog/jfrog-cli
          ref: master
          path: jfrog-cli

      - name: Checkout build-info-go
        if: needs.Detect-Deps.outputs.build_info_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.build_info_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.build_info_go_ref }}
          path: build-info-go

      - name: Checkout jfrog-client-go
        if: needs.Detect-Deps.outputs.jfrog_client_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_client_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_client_go_ref }}
          path: jfrog-client-go

      - name: Checkout jfrog-cli-core
        if: needs.Detect-Deps.outputs.jfrog_cli_core_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_ref }}
          path: jfrog-cli-core

      - name: Setup Go with cache
        uses: jfrog/.github/actions/install-go-with-cache@main

      - name: Setup Go workspace (Unix)
        if: matrix.os.name == 'ubuntu'
        shell: bash
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          [ -d "./build-info-go" ] && go work use ./build-info-go || true
          [ -d "./jfrog-client-go" ] && go work use ./jfrog-client-go || true
          [ -d "./jfrog-cli-core" ] && go work use ./jfrog-cli-core || true

      - name: Setup Go workspace (Windows)
        if: matrix.os.name == 'windows'
        shell: pwsh
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          if (Test-Path "./build-info-go") { go work use ./build-info-go }
          if (Test-Path "./jfrog-client-go") { go work use ./jfrog-client-go }
          if (Test-Path "./jfrog-cli-core") { go work use ./jfrog-cli-core }

      - name: Run Go tests
        working-directory: jfrog-cli
        run: go test -v -timeout 0 --test.go --jfrog.url=${{ secrets.EPLUS_PLATFORM_URL }} --jfrog.adminToken=${{ secrets.EPLUS_ADMIN_TOKEN }} --ci.runId=${{ runner.os }}-go

  NuGet-Tests:
    name: NuGet ${{ matrix.os.name }}
    needs: Detect-Deps
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'push' || contains(github.event.pull_request.labels.*.name, 'safe to test')
    strategy:
      fail-fast: false
      matrix:
        os:
          - name: ubuntu
            version: 24.04
          - name: windows
            version: 2022
    runs-on: ${{ matrix.os.name }}-${{ matrix.os.version }}
    env:
      JFROG_CLI_LOG_LEVEL: DEBUG
      GOPROXY: direct
    steps:
      - name: Checkout jfrog-cli-artifactory
        uses: actions/checkout@v5
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name || github.repository }}
          ref: ${{ github.event.pull_request.head.sha || github.sha }}
          path: jfrog-cli-artifactory

      - name: Checkout jfrog-cli
        uses: actions/checkout@v5
        with:
          repository: jfrog/jfrog-cli
          ref: master
          path: jfrog-cli

      - name: Checkout build-info-go
        if: needs.Detect-Deps.outputs.build_info_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.build_info_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.build_info_go_ref }}
          path: build-info-go

      - name: Checkout jfrog-client-go
        if: needs.Detect-Deps.outputs.jfrog_client_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_client_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_client_go_ref }}
          path: jfrog-client-go

      - name: Checkout jfrog-cli-core
        if: needs.Detect-Deps.outputs.jfrog_cli_core_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_ref }}
          path: jfrog-cli-core

      - name: Prepare ubuntu
        if: matrix.os.name == 'ubuntu'
        run: |
          # Install Mono
          sudo apt-get update
          sudo apt-get install -y apt-transport-https dirmngr gnupg ca-certificates
          sudo apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF
          echo "deb https://download.mono-project.com/repo/ubuntu stable-focal main" | sudo tee /etc/apt/sources.list.d/mono-official-stable.list
          sudo apt-get update
          sudo apt-get install -y mono-complete
          # Fixes dotnet installation issues
          echo "DOTNET_INSTALL_DIR=/usr/share/dotnet" >> $GITHUB_ENV
          sudo mkdir -p /usr/share/dotnet
          sudo chmod 777 /usr/share/dotnet

      - name: Install .NET
        uses: actions/setup-dotnet@v5
        with:
          dotnet-version: "8.x"

      - name: Install NuGet
        uses: nuget/setup-nuget@v2
        with:
          nuget-version: "6.x"

      - name: Setup Go with cache
        uses: jfrog/.github/actions/install-go-with-cache@main

      - name: Setup Go workspace (Unix)
        if: matrix.os.name == 'ubuntu'
        shell: bash
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          [ -d "./build-info-go" ] && go work use ./build-info-go || true
          [ -d "./jfrog-client-go" ] && go work use ./jfrog-client-go || true
          [ -d "./jfrog-cli-core" ] && go work use ./jfrog-cli-core || true

      - name: Setup Go workspace (Windows)
        if: matrix.os.name == 'windows'
        shell: pwsh
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          if (Test-Path "./build-info-go") { go work use ./build-info-go }
          if (Test-Path "./jfrog-client-go") { go work use ./jfrog-client-go }
          if (Test-Path "./jfrog-cli-core") { go work use ./jfrog-cli-core }

      - name: Install local Artifactory
        uses: jfrog/.github/actions/install-local-artifactory@main
        with:
          RTLIC: ${{ secrets.RTLIC }}
          RT_CONNECTION_TIMEOUT_SECONDS: '1200'

      - name: Run NuGet tests
        working-directory: jfrog-cli
        run: go test -v github.com/jfrog/jfrog-cli --timeout 0 --test.nuget

  npm-Tests:
    name: npm ${{ matrix.os.name }}
    needs: Detect-Deps
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'push' || contains(github.event.pull_request.labels.*.name, 'safe to test')
    strategy:
      fail-fast: false
      matrix:
        os:
          - name: ubuntu
            version: 24.04
          - name: windows
            version: 2022
    runs-on: ${{ matrix.os.name }}-${{ matrix.os.version }}
    env:
      JFROG_CLI_LOG_LEVEL: DEBUG
      GOPROXY: direct
    steps:
      - name: Checkout jfrog-cli-artifactory
        uses: actions/checkout@v5
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name || github.repository }}
          ref: ${{ github.event.pull_request.head.sha || github.sha }}
          path: jfrog-cli-artifactory

      - name: Checkout jfrog-cli
        uses: actions/checkout@v5
        with:
          repository: jfrog/jfrog-cli
          ref: master
          path: jfrog-cli

      - name: Checkout build-info-go
        if: needs.Detect-Deps.outputs.build_info_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.build_info_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.build_info_go_ref }}
          path: build-info-go

      - name: Checkout jfrog-client-go
        if: needs.Detect-Deps.outputs.jfrog_client_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_client_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_client_go_ref }}
          path: jfrog-client-go

      - name: Checkout jfrog-cli-core
        if: needs.Detect-Deps.outputs.jfrog_cli_core_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_ref }}
          path: jfrog-cli-core

      - name: Install npm
        uses: actions/setup-node@v5
        with:
          node-version: "16"

      - name: Setup Go with cache
        uses: jfrog/.github/actions/install-go-with-cache@main

      - name: Setup Go workspace (Unix)
        if: matrix.os.name == 'ubuntu'
        shell: bash
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          [ -d "./build-info-go" ] && go work use ./build-info-go || true
          [ -d "./jfrog-client-go" ] && go work use ./jfrog-client-go || true
          [ -d "./jfrog-cli-core" ] && go work use ./jfrog-cli-core || true

      - name: Setup Go workspace (Windows)
        if: matrix.os.name == 'windows'
        shell: pwsh
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          if (Test-Path "./build-info-go") { go work use ./build-info-go }
          if (Test-Path "./jfrog-client-go") { go work use ./jfrog-client-go }
          if (Test-Path "./jfrog-cli-core") { go work use ./jfrog-cli-core }

      - name: Install local Artifactory
        uses: jfrog/.github/actions/install-local-artifactory@main
        with:
          RTLIC: ${{ secrets.RTLIC }}
          RT_CONNECTION_TIMEOUT_SECONDS: '1200'

      - name: Run npm tests
        working-directory: jfrog-cli
        env:
          YARN_IGNORE_NODE: 1
        run: go test -v github.com/jfrog/jfrog-cli --timeout 0 --test.npm

  Maven-Tests:
    name: Maven ${{ matrix.os.name }}
    needs: Detect-Deps
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'push' || contains(github.event.pull_request.labels.*.name, 'safe to test')
    strategy:
      fail-fast: false
      matrix:
        os:
          - name: ubuntu
            version: 24.04
          - name: windows
            version: 2022
    runs-on: ${{ matrix.os.name }}-${{ matrix.os.version }}
    env:
      JFROG_CLI_LOG_LEVEL: DEBUG
      GOPROXY: direct
    steps:
      - name: Checkout jfrog-cli-artifactory
        uses: actions/checkout@v5
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name || github.repository }}
          ref: ${{ github.event.pull_request.head.sha || github.sha }}
          path: jfrog-cli-artifactory

      - name: Checkout jfrog-cli
        uses: actions/checkout@v5
        with:
          repository: jfrog/jfrog-cli
          ref: master
          path: jfrog-cli

      - name: Checkout build-info-go
        if: needs.Detect-Deps.outputs.build_info_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.build_info_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.build_info_go_ref }}
          path: build-info-go

      - name: Checkout jfrog-client-go
        if: needs.Detect-Deps.outputs.jfrog_client_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_client_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_client_go_ref }}
          path: jfrog-client-go

      - name: Checkout jfrog-cli-core
        if: needs.Detect-Deps.outputs.jfrog_cli_core_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_ref }}
          path: jfrog-cli-core

      - name: Setup Go with cache
        uses: jfrog/.github/actions/install-go-with-cache@main

      - name: Setup Maven v3.8.8
        uses: stCarolas/setup-maven@v5
        with:
          maven-version: 3.8.8

      - name: Setup Go workspace (Unix)
        if: matrix.os.name == 'ubuntu'
        shell: bash
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          [ -d "./build-info-go" ] && go work use ./build-info-go || true
          [ -d "./jfrog-client-go" ] && go work use ./jfrog-client-go || true
          [ -d "./jfrog-cli-core" ] && go work use ./jfrog-cli-core || true

      - name: Setup Go workspace (Windows)
        if: matrix.os.name == 'windows'
        shell: pwsh
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          if (Test-Path "./build-info-go") { go work use ./build-info-go }
          if (Test-Path "./jfrog-client-go") { go work use ./jfrog-client-go }
          if (Test-Path "./jfrog-cli-core") { go work use ./jfrog-cli-core }

      - name: Install local Artifactory
        uses: jfrog/.github/actions/install-local-artifactory@main
        with:
          RTLIC: ${{ secrets.RTLIC }}
          RT_CONNECTION_TIMEOUT_SECONDS: '1200'

      - name: Run Maven tests
        working-directory: jfrog-cli
        run: go test -v github.com/jfrog/jfrog-cli --timeout 0 --test.maven

  Gradle-Tests:
    name: Gradle ${{ matrix.gradle-version }} ${{ matrix.os.name }}
    needs: Detect-Deps
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'push' || contains(github.event.pull_request.labels.*.name, 'safe to test')
    strategy:
      fail-fast: false
      matrix:
        os:
          - name: ubuntu
            version: 24.04
          - name: windows
            version: 2022
        gradle-version: [5.6.4, 8.3]
    runs-on: ${{ matrix.os.name }}-${{ matrix.os.version }}
    env:
      JFROG_CLI_LOG_LEVEL: DEBUG
      GOPROXY: direct
      GRADLE_OPTS: -Dorg.gradle.daemon=false
    steps:
      - name: Checkout jfrog-cli-artifactory
        uses: actions/checkout@v5
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name || github.repository }}
          ref: ${{ github.event.pull_request.head.sha || github.sha }}
          path: jfrog-cli-artifactory

      - name: Checkout jfrog-cli
        uses: actions/checkout@v5
        with:
          repository: jfrog/jfrog-cli
          ref: master
          path: jfrog-cli

      - name: Checkout build-info-go
        if: needs.Detect-Deps.outputs.build_info_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.build_info_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.build_info_go_ref }}
          path: build-info-go

      - name: Checkout jfrog-client-go
        if: needs.Detect-Deps.outputs.jfrog_client_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_client_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_client_go_ref }}
          path: jfrog-client-go

      - name: Checkout jfrog-cli-core
        if: needs.Detect-Deps.outputs.jfrog_cli_core_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_ref }}
          path: jfrog-cli-core

      - name: Setup Java
        uses: actions/setup-java@v5
        with:
          distribution: "temurin"
          java-version: "11"

      - name: Setup Gradle
        uses: gradle/gradle-build-action@v3
        with:
          gradle-version: ${{ matrix.gradle-version }}

      - name: Setup Go with cache
        uses: jfrog/.github/actions/install-go-with-cache@main

      - name: Setup Go workspace (Unix)
        if: matrix.os.name == 'ubuntu'
        shell: bash
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          [ -d "./build-info-go" ] && go work use ./build-info-go || true
          [ -d "./jfrog-client-go" ] && go work use ./jfrog-client-go || true
          [ -d "./jfrog-cli-core" ] && go work use ./jfrog-cli-core || true

      - name: Setup Go workspace (Windows)
        if: matrix.os.name == 'windows'
        shell: pwsh
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          if (Test-Path "./build-info-go") { go work use ./build-info-go }
          if (Test-Path "./jfrog-client-go") { go work use ./jfrog-client-go }
          if (Test-Path "./jfrog-cli-core") { go work use ./jfrog-cli-core }

      - name: Install local Artifactory
        uses: jfrog/.github/actions/install-local-artifactory@main
        with:
          RTLIC: ${{ secrets.RTLIC }}
          RT_CONNECTION_TIMEOUT_SECONDS: '1200'

      - name: Run Gradle tests
        working-directory: jfrog-cli
        run: go test -v github.com/jfrog/jfrog-cli --timeout 0 --test.gradle

  Conan-Tests:
    name: Conan ${{ matrix.os.name }}
    needs: Detect-Deps
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'push' || contains(github.event.pull_request.labels.*.name, 'safe to test')
    strategy:
      fail-fast: false
      matrix:
        os:
          - name: ubuntu
            version: 24.04
          - name: windows
            version: 2022
    runs-on: ${{ matrix.os.name }}-${{ matrix.os.version }}
    env:
      JFROG_CLI_LOG_LEVEL: DEBUG
      GOPROXY: direct
    steps:
      - name: Checkout jfrog-cli-artifactory
        uses: actions/checkout@v5
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name || github.repository }}
          ref: ${{ github.event.pull_request.head.sha || github.sha }}
          path: jfrog-cli-artifactory

      - name: Checkout jfrog-cli
        uses: actions/checkout@v5
        with:
          repository: jfrog/jfrog-cli
          ref: master
          path: jfrog-cli

      - name: Checkout build-info-go
        if: needs.Detect-Deps.outputs.build_info_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.build_info_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.build_info_go_ref }}
          path: build-info-go

      - name: Checkout jfrog-client-go
        if: needs.Detect-Deps.outputs.jfrog_client_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_client_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_client_go_ref }}
          path: jfrog-client-go

      - name: Checkout jfrog-cli-core
        if: needs.Detect-Deps.outputs.jfrog_cli_core_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_ref }}
          path: jfrog-cli-core

      - name: Setup Go with cache
        uses: jfrog/.github/actions/install-go-with-cache@main

      - name: Install Conan
        uses: turtlebrowser/get-conan@main
        with:
          version: '2.10.2'

      - name: Setup Go workspace (Unix)
        if: matrix.os.name == 'ubuntu'
        shell: bash
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          [ -d "./build-info-go" ] && go work use ./build-info-go || true
          [ -d "./jfrog-client-go" ] && go work use ./jfrog-client-go || true
          [ -d "./jfrog-cli-core" ] && go work use ./jfrog-cli-core || true

      - name: Setup Go workspace (Windows)
        if: matrix.os.name == 'windows'
        shell: pwsh
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          if (Test-Path "./build-info-go") { go work use ./build-info-go }
          if (Test-Path "./jfrog-client-go") { go work use ./jfrog-client-go }
          if (Test-Path "./jfrog-cli-core") { go work use ./jfrog-cli-core }

      - name: Install local Artifactory
        uses: jfrog/.github/actions/install-local-artifactory@main
        with:
          RTLIC: ${{ secrets.RTLIC }}
          RT_CONNECTION_TIMEOUT_SECONDS: '1200'

      - name: Run Conan tests
        working-directory: jfrog-cli
        run: go test -v github.com/jfrog/jfrog-cli --timeout 0 --test.conan

  Helm-Tests:
    name: Helm ${{ matrix.os.name }}
    needs: Detect-Deps
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'push' || contains(github.event.pull_request.labels.*.name, 'safe to test')
    strategy:
      fail-fast: false
      matrix:
        os:
          - name: ubuntu
            version: 24.04
          - name: windows
            version: 2022
    runs-on: ${{ matrix.os.name }}-${{ matrix.os.version }}
    env:
      JFROG_CLI_LOG_LEVEL: DEBUG
      GOPROXY: direct
    steps:
      - name: Checkout jfrog-cli-artifactory
        uses: actions/checkout@v5
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name || github.repository }}
          ref: ${{ github.event.pull_request.head.sha || github.sha }}
          path: jfrog-cli-artifactory

      - name: Checkout jfrog-cli
        uses: actions/checkout@v5
        with:
          repository: jfrog/jfrog-cli
          ref: master
          path: jfrog-cli

      - name: Checkout build-info-go
        if: needs.Detect-Deps.outputs.build_info_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.build_info_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.build_info_go_ref }}
          path: build-info-go

      - name: Checkout jfrog-client-go
        if: needs.Detect-Deps.outputs.jfrog_client_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_client_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_client_go_ref }}
          path: jfrog-client-go

      - name: Checkout jfrog-cli-core
        if: needs.Detect-Deps.outputs.jfrog_cli_core_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_ref }}
          path: jfrog-cli-core

      - name: Setup Go with cache
        uses: jfrog/.github/actions/install-go-with-cache@main

      - name: Install Helm
        uses: azure/setup-helm@v4
        with:
          version: 'latest'

      - name: Setup Go workspace (Unix)
        if: matrix.os.name == 'ubuntu'
        shell: bash
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          [ -d "./build-info-go" ] && go work use ./build-info-go || true
          [ -d "./jfrog-client-go" ] && go work use ./jfrog-client-go || true
          [ -d "./jfrog-cli-core" ] && go work use ./jfrog-cli-core || true

      - name: Setup Go workspace (Windows)
        if: matrix.os.name == 'windows'
        shell: pwsh
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          if (Test-Path "./build-info-go") { go work use ./build-info-go }
          if (Test-Path "./jfrog-client-go") { go work use ./jfrog-client-go }
          if (Test-Path "./jfrog-cli-core") { go work use ./jfrog-cli-core }

      - name: Install local Artifactory
        uses: jfrog/.github/actions/install-local-artifactory@main
        with:
          RTLIC: ${{ secrets.RTLIC }}
          RT_CONNECTION_TIMEOUT_SECONDS: '1200'

      - name: Run Helm tests
        working-directory: jfrog-cli
        run: go test -v github.com/jfrog/jfrog-cli --timeout 0 --test.helm

  Docker-Tests:
    name: Docker ubuntu
    needs: Detect-Deps
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'push' || contains(github.event.pull_request.labels.*.name, 'safe to test')
    runs-on: ubuntu-24.04
    env:
      JFROG_CLI_LOG_LEVEL: DEBUG
      GOPROXY: direct
    steps:
      - name: Checkout jfrog-cli-artifactory
        uses: actions/checkout@v5
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name || github.repository }}
          ref: ${{ github.event.pull_request.head.sha || github.sha }}
          path: jfrog-cli-artifactory

      - name: Checkout jfrog-cli
        uses: actions/checkout@v5
        with:
          repository: jfrog/jfrog-cli
          ref: master
          path: jfrog-cli

      - name: Checkout build-info-go
        if: needs.Detect-Deps.outputs.build_info_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.build_info_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.build_info_go_ref }}
          path: build-info-go

      - name: Checkout jfrog-client-go
        if: needs.Detect-Deps.outputs.jfrog_client_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_client_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_client_go_ref }}
          path: jfrog-client-go

      - name: Checkout jfrog-cli-core
        if: needs.Detect-Deps.outputs.jfrog_cli_core_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_ref }}
          path: jfrog-cli-core

      - name: Setup Go with cache
        uses: jfrog/.github/actions/install-go-with-cache@main

      - name: Setup Go workspace
        shell: bash
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          [ -d "./build-info-go" ] && go work use ./build-info-go || true
          [ -d "./jfrog-client-go" ] && go work use ./jfrog-client-go || true
          [ -d "./jfrog-cli-core" ] && go work use ./jfrog-cli-core || true

      - name: Containerize Artifactory
        run: |
          cd jfrog-cli/testdata/docker/artifactory/
          ./start.sh
        env:
          RTLIC: ${{ secrets.RTLIC }}
          GOPROXY: direct

      - name: Wait for Artifactory to finish loading
        uses: nev7n/wait_for_response@v1
        with:
          url: "http://localhost:8082"
          responseCode: 200
          timeout: 600000
          interval: 500

      - name: Run Docker tests
        working-directory: jfrog-cli
        run: go test -v -timeout 0 --test.docker

  Podman-Tests:
    name: Podman ubuntu
    needs: Detect-Deps
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'push' || contains(github.event.pull_request.labels.*.name, 'safe to test')
    runs-on: ubuntu-24.04
    env:
      JFROG_CLI_LOG_LEVEL: DEBUG
      GOPROXY: direct
    steps:
      - name: Checkout jfrog-cli-artifactory
        uses: actions/checkout@v5
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name || github.repository }}
          ref: ${{ github.event.pull_request.head.sha || github.sha }}
          path: jfrog-cli-artifactory

      - name: Checkout jfrog-cli
        uses: actions/checkout@v5
        with:
          repository: jfrog/jfrog-cli
          ref: master
          path: jfrog-cli

      - name: Checkout build-info-go
        if: needs.Detect-Deps.outputs.build_info_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.build_info_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.build_info_go_ref }}
          path: build-info-go

      - name: Checkout jfrog-client-go
        if: needs.Detect-Deps.outputs.jfrog_client_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_client_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_client_go_ref }}
          path: jfrog-client-go

      - name: Checkout jfrog-cli-core
        if: needs.Detect-Deps.outputs.jfrog_cli_core_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_ref }}
          path: jfrog-cli-core

      - name: Setup Go with cache
        uses: jfrog/.github/actions/install-go-with-cache@main

      - name: Setup Go workspace
        shell: bash
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          [ -d "./build-info-go" ] && go work use ./build-info-go || true
          [ -d "./jfrog-client-go" ] && go work use ./jfrog-client-go || true
          [ -d "./jfrog-cli-core" ] && go work use ./jfrog-cli-core || true

      - name: Run Podman tests
        working-directory: jfrog-cli
        run: go test -v -timeout 0 --test.podman --jfrog.url=${{ secrets.EPLUS_PLATFORM_URL }} --jfrog.adminToken=${{ secrets.EPLUS_ADMIN_TOKEN }} --test.containerRegistry=${{ secrets.CONTAINER_REGISTRY }}

  Python-Tests:
    name: ${{ matrix.suite }} ${{ matrix.os.name }}
    needs: Detect-Deps
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'push' || contains(github.event.pull_request.labels.*.name, 'safe to test')
    strategy:
      fail-fast: false
      matrix:
        suite: [pip, pipenv]
        os:
          - name: ubuntu
            version: 24.04
          - name: windows
            version: 2022
    runs-on: ${{ matrix.os.name }}-${{ matrix.os.version }}
    env:
      JFROG_CLI_LOG_LEVEL: DEBUG
      GOPROXY: direct
    steps:
      - name: Checkout jfrog-cli-artifactory
        uses: actions/checkout@v5
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name || github.repository }}
          ref: ${{ github.event.pull_request.head.sha || github.sha }}
          path: jfrog-cli-artifactory

      - name: Checkout jfrog-cli
        uses: actions/checkout@v5
        with:
          repository: jfrog/jfrog-cli
          ref: master
          path: jfrog-cli

      - name: Checkout build-info-go
        if: needs.Detect-Deps.outputs.build_info_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.build_info_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.build_info_go_ref }}
          path: build-info-go

      - name: Checkout jfrog-client-go
        if: needs.Detect-Deps.outputs.jfrog_client_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_client_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_client_go_ref }}
          path: jfrog-client-go

      - name: Checkout jfrog-cli-core
        if: needs.Detect-Deps.outputs.jfrog_cli_core_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_ref }}
          path: jfrog-cli-core

      - name: Setup Python3
        uses: actions/setup-python@v6
        with:
          python-version: "3.11.5"

      - name: Setup Pipenv
        if: matrix.suite == 'pipenv'
        run: python -m pip install pipenv

      - name: Setup Twine
        if: matrix.suite == 'pip'
        run: python -m pip install twine

      - name: Setup Go with cache
        uses: jfrog/.github/actions/install-go-with-cache@main

      - name: Setup Go workspace (Unix)
        if: matrix.os.name == 'ubuntu'
        shell: bash
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          [ -d "./build-info-go" ] && go work use ./build-info-go || true
          [ -d "./jfrog-client-go" ] && go work use ./jfrog-client-go || true
          [ -d "./jfrog-cli-core" ] && go work use ./jfrog-cli-core || true

      - name: Setup Go workspace (Windows)
        if: matrix.os.name == 'windows'
        shell: pwsh
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          if (Test-Path "./build-info-go") { go work use ./build-info-go }
          if (Test-Path "./jfrog-client-go") { go work use ./jfrog-client-go }
          if (Test-Path "./jfrog-cli-core") { go work use ./jfrog-cli-core }

      - name: Install local Artifactory
        uses: jfrog/.github/actions/install-local-artifactory@main
        with:
          RTLIC: ${{ secrets.RTLIC }}
          RT_CONNECTION_TIMEOUT_SECONDS: '1200'

      - name: Run Python tests
        working-directory: jfrog-cli
        run: go test -v github.com/jfrog/jfrog-cli --timeout 0 --test.${{ matrix.suite }}

  Lifecycle-Tests:
    name: Lifecycle ${{ matrix.os.name }}
    needs: Detect-Deps
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'push' || contains(github.event.pull_request.labels.*.name, 'safe to test')
    strategy:
      fail-fast: false
      matrix:
        os:
          - name: ubuntu
            version: 24.04
          - name: windows
            version: 2022
    runs-on: ${{ matrix.os.name }}-${{ matrix.os.version }}
    env:
      JFROG_CLI_LOG_LEVEL: DEBUG
      GOPROXY: direct
    steps:
      - name: Checkout jfrog-cli-artifactory
        uses: actions/checkout@v5
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name || github.repository }}
          ref: ${{ github.event.pull_request.head.sha || github.sha }}
          path: jfrog-cli-artifactory

      - name: Checkout jfrog-cli
        uses: actions/checkout@v5
        with:
          repository: jfrog/jfrog-cli
          ref: master
          path: jfrog-cli

      - name: Checkout build-info-go
        if: needs.Detect-Deps.outputs.build_info_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.build_info_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.build_info_go_ref }}
          path: build-info-go

      - name: Checkout jfrog-client-go
        if: needs.Detect-Deps.outputs.jfrog_client_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_client_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_client_go_ref }}
          path: jfrog-client-go

      - name: Checkout jfrog-cli-core
        if: needs.Detect-Deps.outputs.jfrog_cli_core_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_ref }}
          path: jfrog-cli-core

      - name: Setup Go with cache
        uses: jfrog/.github/actions/install-go-with-cache@main

      - name: Setup Go workspace (Unix)
        if: matrix.os.name == 'ubuntu'
        shell: bash
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          [ -d "./build-info-go" ] && go work use ./build-info-go || true
          [ -d "./jfrog-client-go" ] && go work use ./jfrog-client-go || true
          [ -d "./jfrog-cli-core" ] && go work use ./jfrog-cli-core || true

      - name: Setup Go workspace (Windows)
        if: matrix.os.name == 'windows'
        shell: pwsh
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          if (Test-Path "./build-info-go") { go work use ./build-info-go }
          if (Test-Path "./jfrog-client-go") { go work use ./jfrog-client-go }
          if (Test-Path "./jfrog-cli-core") { go work use ./jfrog-cli-core }

      - name: Install local Artifactory
        uses: jfrog/.github/actions/install-local-artifactory@main
        with:
          RTLIC: ${{ secrets.RTLIC }}
          RT_CONNECTION_TIMEOUT_SECONDS: '1200'

      - name: Run Lifecycle tests
        working-directory: jfrog-cli
        run: go test -v github.com/jfrog/jfrog-cli --timeout 0 --test.lifecycle --jfrog.url=http://127.0.0.1:8082 --jfrog.adminToken=${{ env.JFROG_TESTS_LOCAL_ACCESS_TOKEN }} --ci.runId=${{ runner.os }}-lifecycle

  Distribution-Tests:
    name: Distribution ${{ matrix.os.name }}
    needs: Detect-Deps
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'push' || contains(github.event.pull_request.labels.*.name, 'safe to test')
    strategy:
      fail-fast: false
      matrix:
        os:
          - name: ubuntu
            version: 24.04
          - name: windows
            version: 2022
    runs-on: ${{ matrix.os.name }}-${{ matrix.os.version }}
    env:
      JFROG_CLI_LOG_LEVEL: DEBUG
      GOPROXY: direct
    steps:
      - name: Checkout jfrog-cli-artifactory
        uses: actions/checkout@v5
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name || github.repository }}
          ref: ${{ github.event.pull_request.head.sha || github.sha }}
          path: jfrog-cli-artifactory

      - name: Checkout jfrog-cli
        uses: actions/checkout@v5
        with:
          repository: jfrog/jfrog-cli
          ref: master
          path: jfrog-cli

      - name: Checkout build-info-go
        if: needs.Detect-Deps.outputs.build_info_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.build_info_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.build_info_go_ref }}
          path: build-info-go

      - name: Checkout jfrog-client-go
        if: needs.Detect-Deps.outputs.jfrog_client_go_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_client_go_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_client_go_ref }}
          path: jfrog-client-go

      - name: Checkout jfrog-cli-core
        if: needs.Detect-Deps.outputs.jfrog_cli_core_repo != ''
        uses: actions/checkout@v5
        with:
          repository: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_repo }}
          ref: ${{ needs.Detect-Deps.outputs.jfrog_cli_core_ref }}
          path: jfrog-cli-core

      - name: Setup Go with cache
        uses: jfrog/.github/actions/install-go-with-cache@main

      - name: Setup Go workspace (Unix)
        if: matrix.os.name == 'ubuntu'
        shell: bash
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          [ -d "./build-info-go" ] && go work use ./build-info-go || true
          [ -d "./jfrog-client-go" ] && go work use ./jfrog-client-go || true
          [ -d "./jfrog-cli-core" ] && go work use ./jfrog-cli-core || true

      - name: Setup Go workspace (Windows)
        if: matrix.os.name == 'windows'
        shell: pwsh
        run: |
          go work init
          go work use ./jfrog-cli
          go work use ./jfrog-cli-artifactory
          if (Test-Path "./build-info-go") { go work use ./build-info-go }
          if (Test-Path "./jfrog-client-go") { go work use ./jfrog-client-go }
          if (Test-Path "./jfrog-cli-core") { go work use ./jfrog-cli-core }

      - name: Run Distribution tests
        working-directory: jfrog-cli
        run: go test -v github.com/jfrog/jfrog-cli --timeout 0 --test.distribution --jfrog.url=${{ secrets.EPLUS_PLATFORM_URL }} --jfrog.adminToken=${{ secrets.EPLUS_ADMIN_TOKEN }} --jfrog.user=${{ secrets.PLATFORM_USER }} --ci.runId=${{ runner.os }}-distribution
